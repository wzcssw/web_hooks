<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
        <title>0.0</title>
        <script src="http://apps.bdimg.com/libs/jquery/1.9.1/jquery.min.js"></script>
        <style>
          .ball{
            height:60px;
            width:60px;
            position:absolute;
            border-radius:30px;
            margin-top: -120px;
          }
          .score-panel{
            width: 100px;
            height:60px;
            background:#E4E0E0;
          }
          .score-span{
            font-weight:900;
            font-size:48px;
            color:red
          }
          .green{ background:green; }
          .grey{ background:grey; }
          .red{ background:red; }
        </style>
    </head>
    <body>
      <!-- 各种球，你随便加 -->
      <div class="ball green"></div>
      <div class="ball green"></div>
      <div class="ball green"></div>
      <div class="ball grey"></div>
      <div class="ball grey"></div>
      <div class="ball grey"></div>
      <div class="ball grey"></div>
      <div class="ball red"></div>
      <div class="ball red"></div>
      <!-- 计分器 -->
      <div class="score-panel">Your Score: 
        <span class="score-span">0</span>
      </div>
      <script>
        var score = 0; //得分
        var window_width = $(window).width();
        var window_height = $(window).height();

        $().ready(function () {
          alert("Are you ready?");
          $(".ball").each(function(i,e){ // 启动所有小球
            $(e).attr("lock","false"); // 定义锁
            var balls_color = $(e).attr('class').split(' ')[1];
            $(e).click(function(){ // 定义click事件
              ball_click(e,balls_color);
            });
            run(e); 
          });
        });
        function run(self){ // 设定随机的启动时间
          setTimeout(function(){
              random_start(self);
            },get_random_num(0,4500));
        }
        function random_start(self){//下落
          $(self).css("top","0px"); //返回页面上端
          $(self).css("marginLeft",get_random_num(200,window_width-200)+'px'); // 随机出现位置
          $(self).attr("lock","false"); //解锁
          $(self).show();
          $(self).animate({
            top: window_height + 200 + 'px'
          },{
             duration: get_random_num(4,6)*1000, // 随机速度
             complete: function(){ // 落底后再次启动
                $(self).hide();
                run(self); 
              }
            });
        }
        function ball_click(self,balls_color){  //点击小球
          switch(balls_color){
            case "green":
              if($(self).attr("lock")=="false"){
                score += 10;
                $(self).attr("lock","true"); // 上锁
                $(".score-span").html(score);
              }
              break;
            case "red": // 结束游戏
              alert("Game over, your score: " + score);
              window.location.reload();
              break;
            default:
              break;
          }
          ball_click_animate(self);
        }
        function ball_click_animate(self){ // 小球被点击动画
          $(self).stop();
          var increase = {marginLeft: "+=-10px",marginTop: "+=-10px",width: "+=20px",height: "+=20px",borderRadius:"+=10px"};
          var decrease = {marginLeft: "+=10px",marginTop: "+=10px",width: "60px",height: "60px",borderRadius:"30px"};
          $(self).animate(increase,{
               duration: 150,
               complete: function(){
                  $(self).animate(decrease,50);
                  $(self).hide();
                  // 动画结束后重新启动
                  run(self);
                }
              });
        }
        function get_random_num(min,max){  // 随机数 
          var range = max - min;   
          var rand = Math.random();   
          return (min + Math.round(rand * range));   
        }  
      </script>
    </body>
</html>